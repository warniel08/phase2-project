require 'httparty'
require 'json'

class Weather < ActiveRecord::Base
  def self.weather_man
    #need to write the weather api stuff here
    state = "WA"
    city = "Seattle"
    url = "http://api.wunderground.com/api/#{ENV["WEATHER_UNDERGROUND_API_KEY"]}/geolookup/conditions/q/#{state}/#{city}.json"
    response = HTTParty.get(url)
    data = JSON.parse(response.body)
    location = data['location']['city']
    temp_f = data['current_observation']['temp_f']
    icon_url = data['current_observation']['icon_url']

    Weather.find_or_create_by(temperature: temp_f, weather_img: icon_url)
  end
end

# {"response"=>{"version"=>"0.1", "termsofService"=>"http://www.wunderground.com/weather/api/d/terms.html", "features"=>{"geolookup"=>1, "conditions"=>1}},
# "location"=>{"type"=>"CITY", "country"=>"US", "country_iso3166"=>"US", "country_name"=>"USA", "state"=>"WA", "city"=>"Seattle", "tz_short"=>"PST", "tz_long"=>"America/Los_Angeles", "lat"=>"47.61000061", "lon"=>"-122.33000183", "zip"=>"98101", "magic"=>"1", "wmo"=>"99999", "l"=>"/q/zmw:98101.1.99999", "requesturl"=>"US/WA/Seattle.html", "wuiurl"=>"https://www.wunderground.com/US/WA/Seattle.html", "nearby_weather_stations"=>{"airport"=>{"station"=>[{"city"=>"Seattle Boeing", "state"=>"WA", "country"=>"US", "icao"=>"KBFI", "lat"=>"47.52999878", "lon"=>"-122.30000305"}, {"city"=>"Renton", "state"=>"WA", "country"=>"US", "icao"=>"KRNT", "lat"=>"47.49000168", "lon"=>"-122.22000122"}, {"city"=>"Seattle", "state"=>"WA", "country"=>"US", "icao"=>"KSEA", "lat"=>"47.45000076", "lon"=>"-122.30999756"}, {"city"=>"Everett", "state"=>"WA", "country"=>"US", "icao"=>"KPAE", "lat"=>"47.90999985", "lon"=>"-122.27999878"}]}, "pws"=>{"station"=>[{"neighborhood"=>"Seattle", "city"=>"Seattle", "state"=>"WA", "country"=>"US", "id"=>"KWASEATT1303", "lat"=>47.606155, "lon"=>-122.337868, "distance_km"=>0, "distance_mi"=>0}, {"neighborhood"=>"Downtown Seattle", "city"=>"Seattle", "state"=>"WA", "country"=>"US", "id"=>"KWASEATT1627", "lat"=>47.606285, "lon"=>-122.338257, "distance_km"=>0, "distance_mi"=>0}, {"neighborhood"=>"Belltown", "city"=>"Seattle", "state"=>"WA", "country"=>"US", "id"=>"KWASEATT288", "lat"=>47.617641, "lon"=>-122.336761, "distance_km"=>0, "distance_mi"=>0}, {"neighborhood"=>"Belltown", "city"=>"Seattle", "state"=>"WA", "country"=>"US", "id"=>"KWASEATT338", "lat"=>47.618229, "lon"=>-122.338593, "distance_km"=>1, "distance_mi"=>0}, {"neighborhood"=>"South Lake Union", "city"=>"Seattle", "state"=>"WA", "country"=>"US", "id"=>"KWASEATT329", "lat"=>47.618912, "lon"=>-122.337891, "distance_km"=>1, "distance_mi"=>0}, {"neighborhood"=>"Seattle", "city"=>"Seattle", "state"=>"WA", "country"=>"US", "id"=>"KWASEATT588", "lat"=>47.615513, "lon"=>-122.315735, "distance_km"=>1, "distance_mi"=>0}, {"neighborhood"=>"Seattle", "city"=>"Seattle", "state"=>"WA", "country"=>"US", "id"=>"KWASEATT915", "lat"=>47.617176, "lon"=>-122.342636, "distance_km"=>1, "distance_mi"=>0}, {"neighborhood"=>"Seattle", "city"=>"Seattle", "state"=>"WA", "country"=>"US", "id"=>"KWASEATT600", "lat"=>47.606117, "lon"=>-122.314262, "distance_km"=>1, "distance_mi"=>0}, {"neighborhood"=>"Belltown", "city"=>"Seattle", "state"=>"WA", "country"=>"US", "id"=>"KWASEATT306", "lat"=>47.61525, "lon"=>-122.345642, "distance_km"=>1, "distance_mi"=>0}, {"neighborhood"=>"UW Integrated Design Lab, Bullitt Center", "city"=>"Seattle", "state"=>"WA", "country"=>"US", "id"=>"KWASEATT182", "lat"=>47.614361, "lon"=>-122.312439, "distance_km"=>1, "distance_mi"=>0}, {"neighborhood"=>"Capitol Hill", "city"=>"Seattle", "state"=>"WA", "country"=>"US", "id"=>"KWASEATT1673", "lat"=>47.622215, "lon"=>-122.32283, "distance_km"=>1, "distance_mi"=>0}, {"neighborhood"=>"Bell Town", "city"=>"Seattle", "state"=>"WA", "country"=>"US", "id"=>"KWASEATT419", "lat"=>47.623619, "lon"=>-122.332069, "distance_km"=>1, "distance_mi"=>0}, {"neighborhood"=>"Belltown", "city"=>"Seattle", "state"=>"WA", "country"=>"US", "id"=>"KWASEATT402", "lat"=>47.6147, "lon"=>-122.349968, "distance_km"=>1, "distance_mi"=>0}, {"neighborhood"=>"Capitol Hill", "city"=>"Seattle", "state"=>"WA", "country"=>"US", "id"=>"KWASEATT373", "lat"=>47.624172, "lon"=>-122.320946, "distance_km"=>1, "distance_mi"=>1}, {"neighborhood"=>"Capitol Hill", "city"=>"Seattle", "state"=>"WA", "country"=>"US", "id"=>"KWASEATT272", "lat"=>47.625446, "lon"=>-122.327095, "distance_km"=>1, "distance_mi"=>1}, {"neighborhood"=>"Central District - Greg's Den", "city"=>"Seattle", "state"=>"WA", "country"=>"US", "id"=>"KWASEATT1660", "lat"=>47.60445, "lon"=>-122.302933, "distance_km"=>2, "distance_mi"=>1}, {"neighborhood"=>"Volunteer Park", "city"=>"Seattle", "state"=>"WA", "country"=>"US", "id"=>"KWASEATT110", "lat"=>47.630219, "lon"=>-122.314316, "distance_km"=>2, "distance_mi"=>1}, {"neighborhood"=>"Queen Anne Southern Exposure", "city"=>"Seattle", "state"=>"WA", "country"=>"US", "id"=>"KWASEATT116", "lat"=>47.626808, "lon"=>-122.353851, "distance_km"=>2, "distance_mi"=>1}, {"neighborhood"=>"Madison Valley", "city"=>"Seattle", "state"=>"WA", "country"=>"US", "id"=>"KWASEATT404", "lat"=>47.619488, "lon"=>-122.2976, "distance_km"=>2, "distance_mi"=>1}, {"neighborhood"=>"Seattle", "city"=>"Seattle", "state"=>"WA", "country"=>"US", "id"=>"KWASEATT1681", "lat"=>47.589012, "lon"=>-122.311432, "distance_km"=>2, "distance_mi"=>1}, {"neighborhood"=>"North Beacon Hill", "city"=>"Seattle", "state"=>"WA", "country"=>"US", "id"=>"KWASEATT526", "lat"=>47.58762, "lon"=>-122.315254, "distance_km"=>2, "distance_mi"=>1}, {"neighborhood"=>"Seattle Girls School Garden", "city"=>"Seattle", "state"=>"WA", "country"=>"US", "id"=>"KWASEATT245", "lat"=>47.599674, "lon"=>-122.296761, "distance_km"=>2, "distance_mi"=>1}, {"neighborhood"=>"Judkins Park", "city"=>"Seattle", "state"=>"WA", "country"=>"US", "id"=>"KWASEATT428", "lat"=>47.592491, "lon"=>-122.303024, "distance_km"=>2, "distance_mi"=>1}, {"neighborhood"=>"Queen Anne", "city"=>"Seattle", "state"=>"WA", "country"=>"US", "id"=>"KWASEATT457", "lat"=>47.630779, "lon"=>-122.352295, "distance_km"=>2, "distance_mi"=>1}, {"neighborhood"=>"Madrona", "city"=>"Seattle", "state"=>"WA", "country"=>"US", "id"=>"KWASEATT334", "lat"=>47.617264, "lon"=>-122.29287, "distance_km"=>2, "distance_mi"=>1}]}}},
# "current_observation"=>{"image"=>{"url"=>"http://icons.wxug.com/graphics/wu2/logo_130x80.png", "title"=>"Weather Underground", "link"=>"http://www.wunderground.com"}, 
# "display_location"=>{"full"=>"Seattle, WA", "city"=>"Seattle", "state"=>"WA", "state_name"=>"Washington", "country"=>"US", "country_iso3166"=>"US", "zip"=>"98101", "magic"=>"1", "wmo"=>"99999", "latitude"=>"47.61000061", "longitude"=>"-122.33000183", "elevation"=>"34.1"},
# "observation_location"=>{"full"=>"Seattle, Seattle, Washington", "city"=>"Seattle, Seattle", "state"=>"Washington", "country"=>"US", "country_iso3166"=>"US", "latitude"=>"47.606155", "longitude"=>"-122.337868", "elevation"=>"0 ft"}, "estimated"=>{}, "station_id"=>"KWASEATT1303", "observation_time"=>"Last Updated on January 20, 3:48 PM PST", "observation_time_rfc822"=>"Fri, 20 Jan 2017 15:48:56 -0800", "observation_epoch"=>"1484956136", "local_time_rfc822"=>"Fri, 20 Jan 2017 15:53:46 -0800", "local_epoch"=>"1484956426", "local_tz_short"=>"PST", "local_tz_long"=>"America/Los_Angeles", "local_tz_offset"=>"-0800", "weather"=>"Overcast", "temperature_string"=>"51.4 F (10.8 C)", "temp_f"=>51.4, "temp_c"=>10.8, "relative_humidity"=>"70%", "wind_string"=>"Calm", "wind_dir"=>"SSW", "wind_degrees"=>192, "wind_mph"=>0.6, "wind_gust_mph"=>"2.5", "wind_kph"=>1.0, "wind_gust_kph"=>"4.0", "pressure_mb"=>"985", "pressure_in"=>"29.10", "pressure_trend"=>"0", "dewpoint_string"=>"42 F (6 C)", "dewpoint_f"=>42, "dewpoint_c"=>6, "heat_index_string"=>"NA", "heat_index_f"=>"NA", "heat_index_c"=>"NA", "windchill_string"=>"NA", "windchill_f"=>"NA", "windchill_c"=>"NA", "feelslike_string"=>"51.4 F (10.8 C)", "feelslike_f"=>"51.4", "feelslike_c"=>"10.8", "visibility_mi"=>"10.0", "visibility_km"=>"16.1", "solarradiation"=>"--", "UV"=>"0", "precip_1hr_string"=>"-999.00 in ( 0 mm)", "precip_1hr_in"=>"-999.00", "precip_1hr_metric"=>" 0", "precip_today_string"=>"0.00 in (0 mm)", "precip_today_in"=>"0.00", "precip_today_metric"=>"0", "icon"=>"cloudy", "icon_url"=>"http://icons.wxug.com/i/c/k/cloudy.gif", "forecast_url"=>"http://www.wunderground.com/US/WA/Seattle.html", "history_url"=>"http://www.wunderground.com/weatherstation/WXDailyHistory.asp?ID=KWASEATT1303", "ob_url"=>"http://www.wunderground.com/cgi-bin/findweather/getForecast?query=47.606155,-122.337868", "nowcast"=>""}}
